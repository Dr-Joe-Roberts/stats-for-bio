---
title: "Chi-square goodness of fit"
output:
  html_document:
    css: ../extras.css
    theme: cerulean
    highlight: tango
---

The bean weevil, *Callosobruchus maculatus*, lays its eggs on the surface of legume seeds such as black-eyed beans and aduki beans. In an experiment to test whether female *Callosobruchus* are selective in the type of beans on which they oviposit, choice tests were carried out. In each, a single newly mated female was introduced into an experimental arena containing one each of 5 bean types. The bean on which the first egg was laid was recorded. The test was repeated 45 times with a different beetle each time. This table shows the raw data.

  Bean type                 Aduki   Black-eyed   Kidney   Haricot   Pinto
  ------------------------ ------- ------------ -------- --------- -------
  Number of times chosen      6         16         10        8        5

### First steps
As always start by loading the necessary packages.
```{r, message = FALSE, warning = FALSE}
library(dplyr)
library(ggplot2)
```

Make a dataframe using the data from the table above.

```{r}
beans <- data.frame(Bean = c("Aduki","Black-eyed","Kidney","Haricot","Pinto"),
           Frequency = c(6, 16, 10, 8, 5))
```

Remember that the $\chi^2$ test assumes that the data are independent counts of objects or events (oviposition in this example) which can be classified into mutually exclusive categories (bean type in this example). This should have been thought about as part of the experimental design.

### Visualising the data
Plot the frequencies of bean weevils found on each bean type.

```{r, fig.width=4, fig.asp=1.0, fig.align='center'}
ggplot(data = beans, aes(x = Bean, y = Frequency)) +
  geom_bar(stat = "identity")
```

### Carrying out the test

First calculate the expected proportions (note the expected values must be proportions rather than counts). Here, the null hypothesis is that there is no difference in the frequency of oviposition among the different types of beans. 

```{r}
# observed frequencies
obs_freq <- c(6, 16, 10, 8, 5)

# calculate the number of categories
n_cat <- length(obs_freq)
# calculate the proportion for each category (equal frequencies in this e.g.)
expected_probs <- rep(1, n_cat) / n_cat
expected_probs
```

Then carry out the $\chi^2$ test. The first argument is the numeric vector of observed counts (the data) and the second is the expected proportions in each category:

```{r}
chisq.test(obs_freq, p = expected_probs)
```

Remember that if your null hypothesis is that there is no difference among the categories then you can miss out the step where you calculate the expected values, as by default R will assume we meant to use the ‘equal frequencies’ null hypothesis. 

For example this code will give the same results as that above:
```{r}
chisq.test(obs_freq)
```

Now look at the model output. The final line of this output is the one we care about: `X-squared = 8.44, df = 4, p-value = 0.08`. This output shows us the $\chi^2$ test statistic, the degrees of freedom associated with the test, and the p-value. Since p > 0.05, we conclude that female *Callosobruchus* are not significantly selective in the type of beans on which they oviposit (though it is worth noting that the p value is quite close to 0.05).  
<br>
Remember that one assumption of the chi-square test is that the expected counts are not too low. The rule of thumb is that the expected values should be greater than 5. If any of the expected values are below 5 the p-values generated by the test start to become less reliable. In this case R will produce a similar warning message to this:

```{r, results = FALSE, echo = FALSE}
chisq.test(c(2,5,7,5,5))
```

If you get a warning like this then the $\chi^2$ test is not appropriate for the data collected. As there was no warning message here the data met the assumption of the $\chi^2$ test. 

### Presenting the results

The results could be presented as follows

> Oviposition frequency does not vary significantly among the five bean types (Figure 1; $\chi^2$=8.44, d.f.=4, p=0.08).

Make the figure above slightly neater to be put into a report. 

```{r, fig.width=4, fig.asp=1.0, fig.align='center'}
ggplot(data = beans, aes(x = Bean, y = Frequency)) +
  ## Add the bars
  geom_bar(stat = "identity") + 
  ## Change the axes labels
  labs(x="Bean type", y = "Oviposition frequency") + 
  ## Use a more professional theme
  theme_bw()
```
